<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Edit Schedule</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="assets/js/parse-1.0.22.min.js"></script>
    <script>   Parse.initialize("TIldwuoIRCtapKy7qoijP8TLFRXhCkIRc42AcCaT", "UAMfXaWzr0BQAxcCCaIjZD7HWGmWPXRHdZEwzpDO"); </script>
    <script type="text/javascript">var currentUser = Parse.User.current();
  if(currentUser) {

  }
  else {
    location.replace('Login.html');
  }
</script>
    <!-- Le styles -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="assets/css/structure.css" rel="stylesheet">
    <link href="assets/css/cus-icons.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6- 8 support of HTML5 elements -->
    <!--[if lt IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
  </head>
    <body onLoad='javascript:hideAlerts();javascript:checkLogin();javascript:resetSchedule();'>



    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
       <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          
          <a class="brand" href="home.html">
                      <img src="assets/img/icon.png"/> Clubs NI</a>

          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li class="disabled"><a href="#">Profile</a></li>
              <li class="unactive"><a href="reviews.html">Our Reviews</a></li>
              <li class="unactive"><a href="#">Analytics</a></li>

            </ul>

          </div><!--/.nav-collapse -->

        </div>
      </div>
    </div>
        <br/>
    <div class="well well-small">
         <a class="btn btn-primary" onClick="logOut()" style='float:right;'>Logout</a>
        Welcome, <script> 
                if(Parse.User.current())document.write(Parse.User.current().get('username'));</script>
          </div>

    <div class="container">
          <div class="container-fluid">
            <span class="span12">
               <div class="alert" width="300px" id="scheduleLoading" style="display:none">
       Loading <img src='assets/img/logging.gif'/>
       </div>
       <div class="alert alert-error"  id='scheduleFailed' style="display:none">
       There was a problem getting the schedule information.
     </div>
      <div class="alert alert-success"  id='saveSuccess' style="display:none">
       Schedule saved!
     </div> 
     <div class="alert alert-error"  id='saveError' style="display:none">
       There was a problem saving the schedule information. Try again shortly.
     </div>
    <div class="progress progress-striped" id='progressContainer'>
      <div class="bar" style="width: 20%;" id='savingBar'></div>
</div>
                  <button class="btn" onClick="javascript:saveChanges()"><i class="cus-disk"></i> Save Changes</button>
<br/><br/>
<div class="accordion" id="accordion2">
  <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
        Monday
      </a>
    </div>
    <div id="collapseOne" class="accordion-body collapse in">
      <div class="accordion-inner">
      <input type="text" tabindex="1" placeholder="Night" id='mondayName'>
       <textarea rows="3" id='mondayDescription'></textarea>

      </div>
    </div>
  </div>
  <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
        Tuesday
      </a>
    </div>
    <div id="collapseTwo" class="accordion-body collapse">
      <div class="accordion-inner">
            <input type="text" tabindex="1" placeholder="Night" id='tuesdayName'>  
            <textarea rows="3" id='tuesdayDescription'></textarea>
      </div>
    </div>
  </div>
   <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseThree">
        Wednesday
      </a>
    </div>
    <div id="collapseThree" class="accordion-body collapse">
      <div class="accordion-inner">
            <input type="text" tabindex="1" placeholder="Night" id='wednesdayName'>  
            <textarea rows="3" id='WednesdayDescription'></textarea>

      </div>
    </div>
  </div>
  <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseFour">
        Thursday
      </a>
    </div>
    <div id="collapseFour" class="accordion-body collapse">
      <div class="accordion-inner">
            <input type="text" tabindex="1" placeholder="Night" id='thursdayName'>  
            <textarea rows="3" id='thursdayDescription'></textarea>

      </div>
    </div>
  </div>
   <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseFive">
        Friday
      </a>
    </div>
    <div id="collapseFive" class="accordion-body collapse">
      <div class="accordion-inner">
            <input type="text" tabindex="1" placeholder="Night" id='fridayName'>  
            <textarea rows="3" id='fridayDescription'></textarea>

      </div>
    </div>
  </div>
     <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseSix">
        Saturday
      </a>
    </div>
    <div id="collapseSix" class="accordion-body collapse">
      <div class="accordion-inner">
            <input type="text" tabindex="1" placeholder="Night" id='saturdayName'>  
            <textarea rows="3" id='saturdayDescription'></textarea>

      </div>
    </div>
  </div>   <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseSeven">
        Sunday
      </a>
    </div>
    <div id="collapseSeven" class="accordion-body collapse">
      <div class="accordion-inner">
            <input type="text" tabindex="1" placeholder="Night" id='sundayName'>  
            <textarea rows="3" id='sundayDescription'></textarea>

      </div>
    </div>
  </div>
</div>

     
    </div> <!-- /container -->


   
    <!-- Le javascript
================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap-transition.js"></script>
    <script src="assets/js/bootstrap-alert.js"></script>
    <script src="assets/js/bootstrap-modal.js"></script>
    <script src="assets/js/bootstrap-dropdown.js"></script>
    <script src="assets/js/bootstrap-scrollspy.js"></script>
    <script src="assets/js/bootstrap-tab.js"></script>
    <script src="assets/js/bootstrap-tooltip.js"></script>
    <script src="assets/js/bootstrap-popover.js"></script>
    <script src="assets/js/bootstrap-button.js"></script>
    <script src="assets/js/bootstrap-collapse.js"></script>
    <script src="assets/js/bootstrap-carousel.js"></script>
    <script src="assets/js/bootstrap-typeahead.js"></script>

    <script type="text/javascript">


function resetSchedule()
{
   $("#scheduleLoading").show();

  var review = Parse.Object.extend("Schedule");
  var query = new Parse.Query(review);
  var bookingData =null;
  query.find({
  success: function(results) {
    fillSchedule(results);

  },
  error: function(error) {
    alert("Error: " + error.code + " " + error.message);
  }
});

}
function saveChanges() {

  var review = Parse.Object.extend("Schedule");
  var query = new Parse.Query(review);
  var bookingData =null;
  query.find({
  success: function(results) {
    
  var days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
  var numSaved =0;
  for(var weekDay =0;weekDay<days.length;weekDay++) {
            for(var r =0;r<results.length;r++) {
          if(results[r].get('night')==days[weekDay]) {
            place = results[r];
            var chars = days[weekDay].split('');
            var firstLower = chars[0].toLowerCase();
            var nightName = firstLower;
            for(var i =1; i<days[weekDay].length;i++) {
                nightName +=chars[i];
            }
            var nightNamefield = document.getElementById(nightName+'Name');
            results[r].set('NightName',nightNamefield.value);
            results[r].save(null, {
              success : function(results) {
                numSaved++;
                d = document.getElementById('savingBar');
                var progress = (100/7)*numSaved;
                $("#progressContainer").show()
                $("#savingBar").show()
                d.style.width=progress +'%';
                if(numSaved==7){
               window.setTimeout(function() { $("#saveSuccess").show(); }, 1000);
               window.setTimeout(function() { $("#savingBar").hide(); }, 5000);
               window.setTimeout(function() { $("#saveSuccess").hide(); }, 5000);
               window.setTimeout(function() { $("#progressContainer").hide(); }, 5000);

             }
              },
              error :function(res,error) {
               $("#saveError").show();
               window.setTimeout(function() { $("#saveError").hide(); }, 5000);

              }
            });
          }
        }
  } 
  console.log('numSaved   ' + numSaved);
  
  },
  error: function(error) {
      } 

});

}

function checkLogin() {
  var currentUser = Parse.User.current();
  if(currentUser) {

  }
  else {
    location.replace('Login.html');
  }

}
function logOut() {
  Parse.User.logOut();
  location.replace('index.html');
}
function fillSchedule(results) {
   var days = ["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];
  for(var weekDay =0;weekDay<days.length;weekDay++) {
              var tbl = document.getElementById('scheduleTable')
        
        console.log(weekDay);
        var place = null;
        for(var r =0;r<results.length;r++) {
          if(results[r].get('night')==days[weekDay]) {
            place = results[r];
            var chars = days[weekDay].split('');
            var firstLower = chars[0].toLowerCase();
            var nightName = firstLower;
            for(var i =1; i<days[weekDay].length;i++) {
                nightName +=chars[i];
            }
                textnode1=document.createTextNode(days[weekDay]);
        var mondayNameField = document.getElementById(nightName+'Name');
        
        mondayNameField.value = place.get('description');
        
          }
        }
        console.log(days[weekDay]);

      
  }
     $("#scheduleLoading").hide();

}
function fillPromos(results) {
  console.log(results);
  for(i=0;i<results.length;i++) {
         if (!document.getElementsByTagName) return;
         var tbl = document.getElementById('promotions')
         tabBody=tbl.getElementsByTagName("TBODY").item(0);
         row=document.createElement("TR");
         cell1 = document.createElement("TD");
         cell2 = document.createElement("TD");
        cell3 = document.createElement("TD");
        var promo = results[i];
        textnode1=document.createTextNode(promo.get('name'));

        textnode2=document.createTextNode('Description');
        textnode3=document.createTextNode(promo.get('date'));
        cell1.appendChild(textnode1);
        cell2.appendChild(textnode2);
        cell3.appendChild(textnode3);
        row.appendChild(cell1);
        row.appendChild(cell2);
        row.appendChild(cell3);

        tabBody.appendChild(row);
      }
}
function hideAlerts() {
   $("#scheduleLoading").hide();
  $("#scheduleFailed").hide();
   $("#savingBar").hide();
 $("#saveSuccess").hide();
$("#progressContainer").hide();
}
</script>
  </body>
</html>

